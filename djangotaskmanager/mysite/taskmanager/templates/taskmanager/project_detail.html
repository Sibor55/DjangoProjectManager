{% extends 'base.html' %}

{% block title %}{{ project.name }}{% endblock %}

{% block content %}
<h1>{{ project.name }}</h1>

<!-- Кнопка редактирования -->
{% if user.is_authenticated %}
    {% for member in project.members.all %}
        {% if member.user == user and member.role == 'owner' %}
            <a href="{% url 'project_update' project.pk %}">✏️ Редактировать проект</a>
        {% endif %}
    {% endfor %}
{% endif %}

<p>{{ project.description }}</p>

<h2>Участники проекта</h2>
{% if project.members.all %}
<ul>
    {% for member in project.members.all %}
        <li>
            {{ member.user.username }} 
            ({{ member.get_role_display }})
            - присоединился {{ member.joined_at|date:"d.m.Y" }}
        </li>
    {% endfor %}
</ul>
{% else %}
    <p>В этом проекте нет участников</p>
{% endif %}

<h2>Задачи проекта</h2>
{% if project.tasks.all %}
<ul>
    {% for task in project.tasks.all %}
        <li>
            <strong>{{ task.title }}</strong>
            - Приоритет: {{ task.get_priority_display }}
            {% if task.status %}
            - Статус: {{ task.status.name }}
            {% endif %}
            (создана {{ task.created_at|date:"d.m.Y" }})
        </li>
    {% endfor %}
</ul>
{% else %}
    <p>В этом проекте пока нет задач</p>
{% endif %}

<a href="{% url 'project_list' %}">Назад к списку проектов</a>
{% endblock %}